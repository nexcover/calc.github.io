<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1.0; maximum-scale=1.0; minimum-scale=1.0; user-scalable=no;" />
    <title>간단한 계산기</title>
    <link rel="stylesheet" href="style.css">
    <script defer src="main.js"></script>
</head>

<body>
    <div class="container">
        <div class="calcBox">
            <textarea id="inputArea" disabled>0</textarea>
            <textarea id="outputArea" disabled>0</textarea>
        </div>

        <div class="buttonBox">
            <table>
                <tr>
                    <td>
                        <button class="etcButton" onclick="allClear()">
                            <p>C</p>
                        </button>
                    </td>
                    <td>
                        <button class="etcButton" onclick="calculate('(')">
                            <p>(</p>
                        </button>
                    </td>
                    <td>
                        <button class="etcButton" onclick="calculate(')')">
                            <p>)</p>
                        </button>
                    </td>
                    <td>
                        <button class="etcButton" onclick="del()">
                            <p style="font-size: 40px;">del</p>
                        </button>
                    </td>
                </tr>
                <tr>
                    <td>
                        <button onclick="num1('7')">
                            <p>7</p>
                        </button>
                    </td>
                    <td>
                        <button onclick="num1('8')">
                            <p>8</p>
                        </button>
                    </td>
                    <td>
                        <button onclick="num1('9')">
                            <p>9</p>
                        </button>
                    </td>
                    <td>
                        <button class="sign" onclick="calculate('/')">
                            <p>÷</p>
                        </button>
                    </td>
                </tr>
                <tr>
                    <td>
                        <button onclick="num1('4')">
                            <p>4</p>
                        </button>
                    </td>
                    <td>
                        <button onclick="num1('5')">
                            <p>5</p>
                        </button>
                    </td>
                    <td>
                        <button onclick="num1('6')">
                            <p>6</p>
                        </button>
                    </td>
                    <td>
                        <button class="sign" onclick="calculate('*')">
                            <p>×</p>
                        </button>
                    </td>
                </tr>
                <tr>
                    <td>
                        <button onclick="num1('1')">
                            <p>1</p>
                        </button>
                    </td>
                    <td>
                        <button onclick="num1('2')">
                            <p>2</p>
                        </button>
                    </td>
                    <td>
                        <button onclick="num1('3')">
                            <p>3</p>
                        </button>
                    </td>
                    <td>
                        <button class="sign" onclick="calculate('-')">
                            <p>−</p>
                        </button>
                    </td>
                </tr>
                <tr>
                    <td>
                        <button onclick="num1('0')">
                            <p>0</p>
                        </button>
                    </td>
                    <td>
                        <button onclick="num1('00')">
                            <p>00</p>
                        </button>
                    </td>
                    <td>
                        <button onclick="dot()">
                            <p>.</p>
                        </button>
                    </td>
                    <td>
                        <button class="sign" onclick="calculate('+')">
                            <p>+</p>
                        </button>
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <script>
        let input = "";
        let output = document.getElementById("outputArea");
        let inputArea = document.getElementById("inputArea");

        function num1(num) {
            if (input.length === 0 && (num === '0' || num === '00')) {
                return;
            }
            if (input.length < Infinity) {
                input += num;
                inputArea.value = input;
                updateOutput();
                updateScroll();
            }
        }

        function dot() {
            if (input === "") {
                input = "0.";
            } else if (!input.includes('.')) {
                if (input === "0") {
                    input = "0.";
                } else if (input.length < 100000000) {
                    input += '.';
                }
            }
            inputArea.value = input;
            updateOutput();
            updateScroll();
        }



        function calculate(operator) {
            if (input.length === 0 && ['+', '*', '/', ')'].includes(operator)) {
                return;
            }

            const lastChar = input[input.length - 1];
            if (['+', '-', '*', '/', ')'].includes(lastChar) && operator === '%') {
                return;
            }

            if (['+', '-', '*', '/', ')'].includes(operator)) {
                if (['+', '-', '*', '/', ')'].includes(lastChar)) {
                    input = input.slice(0, -1);  // 마지막 연산자를 제거
                }
                input += operator;
                inputArea.value = input;
                updateOutput();
                updateScroll();
            }
        }


        function equal() {
            try {
                let result = eval(input);
                output.textContent = formatResult(result);
                input = result.toString();
            } catch (error) {
                output.textContent = "Error";
            }
        }

        function allClear() {
            input = "";
            inputArea.value = "0";
            updateOutput();
            updateScroll();
        }

        function del() {
            if (input.length > 0) {
                input = input.slice(0, -1);
                inputArea.value = input;
                updateOutput();
                updateScroll();
            }
        }

        function updateOutput() {
            try {
                let result = eval(input);
                output.textContent = formatResult(result);
            } catch (error) {
                output.textContent = "수식 입력중";
            }

            if (input === "") {
                output.textContent = "0";
            }
        }

        function formatResult(x) {
            return parseFloat(x.toFixed(4)).toLocaleString('en-US');
        }

        function updateScroll() {
            inputArea.scrollTop = inputArea.scrollHeight;
        }

        inputArea.addEventListener("input", function () {
            input = inputArea.value;
            updateOutput();
            updateScroll();
        });
    </script>
</body>

</html>